<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Khatwa | ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>

<script>
  if (localStorage.getItem('isLoggedIn') !== 'true') {
    window.location.href = 'login.html'
  }
</script>

<nav class="navbar">
  <a class="btn" href="login.html">ุชุณุฌูู ุงูุฏุฎูู</a>
  <a href="index.html" class="logo">
    <img src="assets/logo.png" alt="Khatwa Logo">
  </a>
</nav>

<header class="hero dashboard-hero">
  <div class="hero-overlay">
    <h1 id="welcome"></h1>
    <p>ุฅุฏุงุฑุฉ ููุงุนูุฏ ุงูุนูุงุฌ ุงูุทุจูุนู ุงูุฎุงุตุฉ ุจู ุจุณูููุฉ</p>
    <a class="btn" href="doctors.html">ุญุฌุฒ ููุนุฏ ุฌุฏูุฏ</a>
  </div>
</header>

<section class="stats">
  <div class="stat">
    <h3 id="upcoming-count">0</h3>
    <p>ููุงุนูุฏ ูุงุฏูุฉ</p>
  </div>
  <div class="stat">
    <h3 id="completed-count">0</h3>
    <p>ุฌูุณุงุช ููุชููุฉ</p>
  </div>
  <div class="stat">
    <h3 id="last-appointment">โ</h3>
    <p>ุขุฎุฑ ููุนุฏ</p>
  </div>
</section>

<section class="appointments">
  <h2>ููุงุนูุฏู ุงููุงุฏูุฉ</h2>

  <div id="appointments-list" class="appointments-list">
    <p class="empty">
      ูุง ููุฌุฏ ููุงุนูุฏ ูุญุฌูุฒุฉ ุญุงูููุง<br><br>
      <a class="btn" href="doctors.html">ุงุญุฌุฒ ููุนุฏู ุงูุฃูู</a>
    </p>
  </div>
</section>

<section class="tip">
  <h2>ูุตูุญุฉ ุงูููู</h2>
  <p>ุงูุงูุชุฒุงู ุจุงูุชูุงุฑูู ุงูููุฒููุฉ ูุณุฑูุน ุงูุชุนุงูู ุจูุณุจุฉ ูุจูุฑุฉ.</p>
</section>

<footer class="footer">
  <div class="socials">
    <a href="#">X</a>
    <a href="#">Instagram</a>
    <a href="#">Facebook</a>
  </div>
  <p class="designer">ุชุตููู ูุชุทููุฑ: @criticar_idk</p>
  <p>ยฉ 2025 Khatwa โ ุฌููุน ุงูุญููู ูุญููุธุฉ</p>
</footer>

<script>
  function logout() {
    localStorage.removeItem('isLoggedIn');
    localStorage.removeItem('userName'); // optional: clear name too
    window.location.href = 'login.html';
  }

  // Show user name
  const userName = localStorage.getItem('userName') || "ูุณุชุฎุฏู";
  document.getElementById('welcome').innerText = `ูุฑุญุจุงูุ ${userName}!`;

  const list = document.getElementById('appointments-list');
  let appointments = JSON.parse(localStorage.getItem('appointments')) || [];
  const today = new Date().toISOString().split('T')[0];

  appointments = appointments.map(a => {
    if (a.date < today && a.status === 'upcoming') a.status = 'completed';
    return a;
  });

  localStorage.setItem('appointments', JSON.stringify(appointments));

  const upcoming = appointments.filter(a => a.status === 'upcoming');

  list.innerHTML = '';
  if (!upcoming.length) {
    list.innerHTML = `
      <p class="empty">
        ูุง ููุฌุฏ ููุงุนูุฏ ูุงุฏูุฉ<br><br>
        <a class="btn" href="doctors.html">ุงุญุฌุฒ ููุนุฏ ุฌุฏูุฏ</a>
      </p>
    `;
  } else {
    upcoming.forEach(a => {
      const div = document.createElement('div');
      div.className = 'appointment-card';
      div.innerHTML = `
        <h3>${a.doctor}</h3>
        <p>๐ ${a.date}</p>
        <p>โฐ ${a.time}</p>
        <div class="actions">
          <button onclick="done(${a.id})">ุชูุช ุงูุฌูุณุฉ</button>
          <button onclick="cancel(${a.id})">ุฅูุบุงุก</button>
        </div>
      `;
      list.appendChild(div);
    });
  }

  document.getElementById('upcoming-count').innerText = upcoming.length;
  document.getElementById('completed-count').innerText =
    appointments.filter(a => a.status === 'completed').length;
  document.getElementById('last-appointment').innerText =
    appointments.length ? appointments[appointments.length - 1].date : 'โ';

  function done(id) {
    appointments = appointments.map(a => a.id === id ? { ...a, status: 'completed' } : a);
    localStorage.setItem('appointments', JSON.stringify(appointments));
    location.reload();
  }

  function cancel(id) {
    appointments = appointments.filter(a => a.id !== id);
    localStorage.setItem('appointments', JSON.stringify(appointments));
    location.reload();
  }
</script>

</body>
</html>
